<!DOCTYPE html>
<html>
<head>
<title>Filter Scripts for Topics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
<link href="../style.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="/jquery/jquery-latest.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	if (document.referrer.match(/(client=iOS)/)){ 
		$(".android").hide();
		$(".apple").show();
		window.history.replaceState(null, null, "?client=iOS");
	} 
	if (window.location.href.match(/(client=iOS)/)){ 
		$(".android").hide();
		$(".apple").show();
	}
else if (navigator.userAgent.match(/(iPod|iPhone|iPad|Safari)/)) {
		$(".android").hide();
		$(".apple").show();
	} 
	$("img.thumb").click(function() {
		$("img.thumb").show().next("img.large").hide();
		$(this).hide();
		$(this).next("img.large").fadeIn();
	});
	$("img.large").click(function() {
		$(this).hide();
		$(this).prev("img.thumb").show();
	});
});
</script>
</head>
<body>
<h1>Filter Scripts for Topics</h1>
<p>By default, MQTT push notifications about received MQTT data are
displayed directly in the “Messages” window, which is suitable for simple
text messages. However, MQTT notifications can also be binary, XML, JSON,
or otherwise encoded. Here, JavaScript-based filter scripts offer the
possibility to analyze and format the notifications in order to display
the desired data in the form of a text message.</p>
<div class="android">
<p><img class="thumb" src="../img/javascript_editor.png" width="275">
<img class="large" src="../img/javascript_editor.png"></p>
</div>
<div class="apple">
<p><img class="thumb" src="../img/javascript_editor_iOS.png" width="275">
<img class="large" src="../img/javascript_editor_iOS.png"></p>
</div>
<p>Filter scripts can be accepted via text input or <em>Copy/Paste</em>.
In addition, they are stored on the server so that all mobile devices of
an account display the identical content. The filter scripts are executed
on the mobile device during display. It is possible to test scripts in
advance. Alternatively, a JavaScript can be developed, tested and adopted
in a web browser.</p>
<p>To fiter messages, implement the <tt>filterMsg()</tt> function. The
original message is contained in the “msg.text” parameter and was also
assigned to the variable “content”.</p>
<ul class="instruction">
<li>Modify “msg.text” and assign the modified content to the variable
“content”.</li>
</ul>
<p>The variable “content” is returned to the calling program and determines
the content to be displayed.</p>
<div class="note">
<h6>Important:</h6>
<p>The content of “content” must be of type <tt>string</tt>, i.e. if necessary,
numeric values must be converted. Avoid complex code and actions that
are not used to filter the message.</p>
</div>
<ul class="instruction">
<li>Tap on <span class="android"><span
class="button-color">Run</span></span><span class="apple"><span class="iOS">Run</span></span>
to test your function.</span>
Enter a test message in the “Test Data” input field.
</li>
</ul>
<p>The result of the test run is displayed in the editor status line.</p>
<p>If you have already received news for your topic, the value of the last
message will be preset but can be overwritten.</p>
<h2>Additional filter scripts</h2>
<p>The following examples show how data is extracted and formatted from
messages with different structures. You can also use (<span class="android"><img src="../img/overflow_icon.png" height="16"> > Insert Example >
<em>&lt;Examples&gt;</em></span><span class="apple"><img src="../img/share1.png" height="16"> > Insert Example >
<em>&lt;Examples&gt;</em></span>) to insert the
examples into your code and customize them:</p>
<p class="examples"><a href="examples.html#json"><span class="clicklink">JSON</span></a></p>
<p class="examples"><a href="examples.html#split"><span class="clicklink">Split</span></a></p>
<p class="examples"><a href="examples.html#regex"><span class="clicklink">Regular Expression</span></a></p>
<p class="examples"><a href="examples.html#binary"><span class="clicklink">Binary</span></a></p>
<p class="examples"><a href="examples.html#hexdump"><span class="clicklink">Hexdump</span></a></p>
<h2 id="variables">Variables</h2>
<p>Variables that can be accessed from the
<tt>filterMsg()</tt> function:</p>
<table border="1">
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
<tr>
<td>msg.receivedDate</td>
<td>Time at which the message was received (JavaScript <tt>Date</tt> object)</td>
</tr>
<tr>
<td>msg.topic</td>
<td>Message topic</td>
</tr>
<tr>
<td>msg.text</td>
<td>Message content (original message interpreted as UTF-8 string,
non-displayable characters as well as invalid values are replaced or
marked by the &#xfffd; character</td>
</tr>
<tr>
<td>msg.raw</td>
<td>JavaScript <tt>ArrayBuffer</tt> object containing the original message</td>
</tr>
<tr>
<td>acc.user</td>
<td>MQTT user name</td>
</tr>
<tr>
<td>acc.mqttServer</td>
<td>MQTT server</td>
</tr>
<tr>
<td>acc.pushServer</td>
<td>MQTT push server</td>
</tr>
<tr>
<td>view.setBackgroundColor(<em>&lt;value&gt;</em>)</td>
<td>Message background color, e.g. using the color constant <tt>MQTT.Color.LT_GREEN</tt>
(see <a href="dashboard_scripts.html#morefunctions">details</a>)</td>
</tr>
<tr>
<td>view.setTextColor(<em>&lt;value&gt;</em>)</td>
<td>Message text color, e.g. <tt>0xFF662233</tt> (in hexadecimal ARGB notation with <tt>FF</tt>
defining an alpha value of 100%)<br>
</td>
</tr>
</table>
</body>
</html>

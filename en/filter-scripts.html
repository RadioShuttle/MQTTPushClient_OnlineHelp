<!DOCTYPE html>
<html>
<head>
<title>Filter Scripts for Topics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
<link href="../style.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="/jquery/jquery-latest.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	if (navigator.userAgent.match(/(iPod|iPhone|iPad)/)) {
		$(".android").hide();
		$(".apple").show();
	}
	$("img.thumb").click(function() {
		$("img.thumb").show().next("img.large").hide();
		$(this).hide();
		$(this).next("img.large").fadeIn();
	});
	$("img.large").click(function() {
		$(this).hide();
		$(this).prev("img.thumb").show();
	});
});
</script>
</head>
<body>
<h1>Filter Scripts for Topics</h1>
<p>By default, MQTT push notifications about received MQTT data are
displayed directly in the “Messages” window, which is suitable for simple
text messages. However, MQTT notifications can also be binary, XML, JSON,
or otherwise encoded. Here, JavaScript-based filter scripts offer the
possibility to analyze and format the notifications in order to display
the desired data in the form of a text message.</p>
<div class="android">
<p><img class="thumb" src="../img/javascript_editor.png" width="275">
<img class="large" src="../img/javascript_editor.png"></p>
</div>
<div class="apple">
<p><img class="thumb" src="../img/javascript_editor.png_iOS.png" width="275">
<img class="large" src="../img/javascript_editor.png_iOS.png"></p>
</div>
<p>Filter scripts can be accepted via text input or <em>Copy/Paste</em>.
In addition, they are stored on the server so that all mobile devices of
an account display the identical content. The filter scripts are executed
on the mobile device during display. It is possible to test scripts in
advance. Alternatively, a JavaScript can be developed, tested and adopted
in a web browser.</p>
<p>To fiter messages, implement the <tt>filterMsg()</tt> function. The
original message is contained in the “msg.text” parameter and was also
assigned to the variable “content”.</p>
<ul class="instruction">
<li>Modify “msg.text” and assign the modified content to the variable
“content”.</li>
</ul>
<p>The variable “content” is returned to the calling program and determines
the content to be displayed.</p>
<div class="note">
<p><strong>Important:</strong><br />
The content of “content” must be of type <tt>string</tt>, i.e. if necessary,
numeric values must be converted. Avoid complex code and actions that
are not used to filter the message.</p>
</div>
<ul class="instruction">
<li>Tap on <span class="android"><span
class="button-color">Run</span> to test your function.</span>
Enter a test message in the “Test Data” input field.
</li>
</ul>
<p>The result of the test run is displayed in the editor status line.</p>
<p>If you have already received news for your topic, the value of the last
message will be preset but can be overwritten.</p>
<h2>Additional filter scripts</h2>
<p>Folgende Beispiele zeigen, wie Daten aus Nachrichten mit unterschiedlichen
Strukturen extrahiert und aufbereitet werden. Die Beispiele können Sie auch
mit (<img src="../img/overflow_icon.png" height="16"> > Insert Example >
<em>&lt;Beispiele&gt;</em>) in Ihren Code einfügen und anpassen.</p>
<p class="examples"><span class="clicklink JSON">JSON</span></p>
<p class="examples"><span class="clicklink Split">Split</span></p>
<p class="examples"><span class="clicklink RegEx">Regular Expression</span></p>
<p class="examples"><span class="clicklink Binary">Binary</span></p>
<p class="examples"><span class="clicklink Hexdump">Hexdump</span></p>
<h2>Variables</h2>
<p>Variables that can be accessed from the
<tt>filterMsg()</tt> function:</p>
<table border="1">
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
<tr>
<td>msg.receivedDate</td>
<td>Time at which the message was received (JavaScript <tt>Date</tt> object)</td>
</tr>
<tr>
<td>msg.topic</td>
<td>Message topic</td>
</tr>
<tr>
<td>msg.text</td>
<td>Message content</td>
</tr>
<tr>
<td>acc.user</td>
<td>MQTT user name</td>
</tr>
<tr>
<td>acc.mqttServer</td>
<td>MQTT server</td>
</tr>
<tr>
<td>acc.pushServer</td>
<td>MQTT push server</td>
</tr>
</table>
</body>
</html>

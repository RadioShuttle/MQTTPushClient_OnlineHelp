<!DOCTYPE html>
<html>
<head>
<title>Filterskripte für Topics</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
<link href="../style.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="/jquery/jquery-latest.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	if (navigator.userAgent.match(/(iPod|iPhone|iPad)/)) {
		$(".android").hide();
		$(".apple").show();
	}
	$("img.thumb").click(function() {
		$("img.thumb").show().next("img.large").hide();
		$(this).hide();
		$(this).next("img.large").fadeIn();
	});
	$("img.large").click(function() {
		$(this).hide();
		$(this).prev("img.thumb").show();
	});
});
</script>
</head>
<body>
<h1>Filterskripte für Topics</h1>
<p>Standardmäßig werden MQTT-Push-Benachrichtigungen über empfangene
MQTT-Daten direkt im Fenster „Messages“, das für einfache Textnachrichten
geeignet ist, angezeigt. MQTT-Benachrichtigungen können allerdings
auch binär, XML, JSON oder anderweitig kodiert sein. Hier bieten
JavaScript-basierte Filterskripte die Möglichkeit, die Benachrichtigungen
zu analysieren und zu formatieren, um die gewünschten Daten in Form einer
Textnachricht
darzustellen.</p>
<div class="android">
<p><img class="thumb" src="../img/javascript_editor.png" width="275">
<img class="large" src="../img/javascript_editor.png"></p>
</div>
<div class="apple">
<p><img class="thumb" src="../img/javascript_editor_iOS.png" width="275">
<img class="large" src="../img/javascript_editor_iOS.png"></p>
</div>
<p>Die Filterskripte können per Texteingabe oder <em>Copy/Paste</em>
übernommen werden. Zusätzlich werden sie auf dem Server gespeichert,
damit alle Mobilgeräte eines Kontos den identischen Inhalt anzeigen. Die
Ausführung der Filterskripte erfolgt auf dem Mobilgerät während der
Anzeige. Es besteht die Möglichkeit, erfasste Skripte vorab zu testen.
Alternativ kann ein JavaScript in einem Webbrowser entwickelt bzw.
getestet und übernommen werden.</p>
<p>Implementieren Sie die Funktion <tt>filterMsg()</tt> um Nachrichten
zu filtern. Die Originalnachricht ist im Parameter „msg.text“ enthalten,
welcher der Variablen „content“ zugewiesen wird.</p>
<ul class="instruction">
<li>Modifizieren Sie „msg.text“ und weisen Sie der Variable „content“
den modifizierten Inhalt zu.</li>
</ul>
<p>Die Variable „content“ wird an das aufrufende Programm zurückgegeben
und bestimmt den darzustellenden Inhalt.</p>
<div class="note">
<p><strong>Wichtig:</strong><br />
Der Inhalt von „content“ muss vom Typ <tt>string</tt> sein, d.&nbsp;h.
Sie müssen gegebenenfalls numerische Werte konvertieren. Vermeiden Sie
komplexen Code sowie Aktionen, die nicht dem Filtern der Nachricht dienen.</p>
</div>
<ul class="instruction">
<li>Tippen Sie zum Testen Ihrer Funktion auf <span class="android"><span
class="button-color">Run</span></span><span class="apple"><span class="iOS">Run</span></span>.
Geben Sie dazu eine Testnachricht in das Eingabefeld „Test Data“ ein.
</li>
</ul>
<p>Das Resultat des Testlaufs wird in der Statuszeile des Editors angezeigt.</p>
<p>Sollten Sie bereits Nachrichten für Ihr Topic erhalten haben, wird dieses
Feld zwar mit dem Wert der letzten Nachricht vorbelegt, kann aber überschrieben
werden.</p>
<h2>Weitere Filterskripte</h2>
<p>Folgende Beispiele zeigen, wie Daten aus Nachrichten mit unterschiedlichen
Strukturen extrahiert und aufbereitet werden. Die Beispiele können Sie auch
mit (<span class="android"><img src="../img/overflow_icon.png" height="16"> > Insert Example >
<em>&lt;Beispiele&gt;</em></span><span class="apple"><img src="../img/share1.png" height="16"> > Insert Example >
<em>&lt;Beispiele&gt;</em></span>) in Ihren Code einfügen und anpassen:</p>
<p class="examples"><a href="examples.html#json"><span class="clicklink">JSON</span></a></p>
<p class="examples"><a href="examples.html#split"><span class="clicklink">Split</span></a></p>
<p class="examples"><a href="examples.html#regex"><span class="clicklink">Regular Expression</span></a></p>
<p class="examples"><a href="examples.html#binary"><span class="clicklink">Binary</span></a></p>
<p class="examples"><a href="examples.html#hexdump"><span class="clicklink">Hexdump</span></a></p>
<h2>Variablen</h2>
<p>Variablen, auf die Sie in der Funktion
<tt>filterMsg()</tt> Zugriff haben:</p>
<table border="1">
<tr>
<th>Parameter</th>
<th>Erläuterung</th>
</tr>
<tr>
<td>msg.receivedDate</td>
<td>Zeitpunkt des Empfangs der Nachricht (JavaScript-Objekt <tt>Date</tt>)</td>
</tr>
<tr>
<td>msg.topic</td>
<td>Topic der Nachricht</td>
</tr>
<tr>
<td>msg.text</td>
<td>Nachrichteninhalt (Orginalnachricht interpretiert als UTF-8 String,
nicht darstellbare Zeichen und ungültige Werte werden durch ein &#xfffd;
ersetzt bzw. gekennzeichnet)</td>
</tr>
<tr>
<td>msg.raw</td>
<td>JavaScript <tt>ArrayBuffer</tt>-Objekt, das die Originalnachricht enthält</td>
</tr>
<tr>
<td>acc.user</td>
<td>MQTT-Benutzername</td>
</tr>
<tr>
<td>acc.mqttServer</td>
<td>MQTT-Server</td>
</tr>
<tr>
<td>acc.pushServer</td>
<td>MQTT-Push-Server</td>
</tr>
</table>
</body>
</html>
